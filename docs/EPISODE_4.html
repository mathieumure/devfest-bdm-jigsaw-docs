<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Episode IV - Gradle, un Nouvel Espoir | Star Jigsaw - La guerre des modules</title>
    <meta name="description" content="Hand&#39;s on Jigsaw @ Devfest">
    
    
    <link rel="preload" href="/devfest-nantes-jigsaw-docs/assets/css/0.styles.58ba3768.css" as="style"><link rel="preload" href="/devfest-nantes-jigsaw-docs/assets/js/app.d7b56a1b.js" as="script"><link rel="preload" href="/devfest-nantes-jigsaw-docs/assets/js/7.926724b7.js" as="script"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/2.b0ee0870.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/3.8883d706.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/4.653c9bb9.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/5.0e508211.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/6.8b9c1401.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/8.e8bd7409.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/9.31dcb171.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/10.6d45c8ec.js"><link rel="prefetch" href="/devfest-nantes-jigsaw-docs/assets/js/11.25a312a3.js">
    <link rel="stylesheet" href="/devfest-nantes-jigsaw-docs/assets/css/0.styles.58ba3768.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/devfest-nantes-jigsaw-docs/" class="home-link router-link-active"><!----> <span class="site-name">Star Jigsaw - La guerre des modules</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/devfest-nantes-jigsaw-docs/TIPS.html" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/mathieumure/devfest-nantes-jigsaw-webapp" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Frontend
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/louiznk/hands-on-jigsaw-devfest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/devfest-nantes-jigsaw-docs/TIPS.html" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/mathieumure/devfest-nantes-jigsaw-webapp" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Frontend
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/louiznk/hands-on-jigsaw-devfest" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/devfest-nantes-jigsaw-docs/" class="sidebar-link">A long time ago in a galaxy far far away...</a></li><li><a href="/devfest-nantes-jigsaw-docs/EPISODE_1.html" class="sidebar-link">Episode I - La Menace de la configuration</a></li><li><a href="/devfest-nantes-jigsaw-docs/EPISODE_2.html" class="sidebar-link">Episode II - Le guerre du Hello World</a></li><li><a href="/devfest-nantes-jigsaw-docs/EPISODE_3.html" class="sidebar-link">Episode III - La revanche des Sith Maven</a></li><li><a href="/devfest-nantes-jigsaw-docs/EPISODE_4.html" class="active sidebar-link">Episode IV - Gradle, un Nouvel Espoir</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devfest-nantes-jigsaw-docs/EPISODE_4.html#suivre-le-chemin-des-jedi-configurer-gradle" class="sidebar-link">Suivre le chemin des Jedi: configurer Gradle</a></li></ul></li><li><a href="/devfest-nantes-jigsaw-docs/EPISODE_5.html" class="sidebar-link">Episode V - Yoda contre-attaque</a></li><li><a href="/devfest-nantes-jigsaw-docs/TIPS.html" class="sidebar-link">TIPS</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="episode-iv-gradle-un-nouvel-espoir"><a href="#episode-iv-gradle-un-nouvel-espoir" aria-hidden="true" class="header-anchor">#</a> Episode IV - Gradle, un Nouvel Espoir</h1> <p><img src="/devfest-nantes-jigsaw-docs/assets/img/master_gradle.62725ee3.jpg" alt="Master Gradle"></p> <p>Vous vous rendez compte de la surpercherie de votre maître et suite à un combat épique contre lui, vous êtes sauvé par <strong>Master Gradle</strong>, le Jedi légendaire.</p> <p>Vous le suivez et devenez son Padawan pour sortir du côté obscure de la Force.</p> <div class="language-sh extra-class"><pre class="language-text"><code>cd hands-on-jigsaw-devfest/66-jedi
</code></pre></div><h2 id="suivre-le-chemin-des-jedi-configurer-gradle"><a href="#suivre-le-chemin-des-jedi-configurer-gradle" aria-hidden="true" class="header-anchor">#</a> Suivre le chemin des Jedi: configurer Gradle</h2> <p>Contrairement à Maven, avec Gradle, vous devez configurer les étapes de build et de run pour intégrer les modules. Bien que le côté obscure possède de nombreuses tentations qui permettent d'abstraire cette configuration (comme le plugin <code>chainsaw</code>), ceux-ci sont loin d'être stables.</p> <p>Ajoutez dans l'ensemble des définitions de build gradle (fichiers <code>$$repertoire_du_module$$\build.gradle</code>) des modules une <code>ExtraPropertyExtension</code> qui aura le nom de votre module (voir exemple). Cette propriété sera utilisée lors les builds Gradle pour identifier votre module.</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>ext<span class="token operator">.</span>moduleName <span class="token operator">=</span> <span class="token string gstring">&quot;my.module&quot;</span>
</code></pre></div><p>Une fois que cela est fait, il faut modifier le fichier <code>build.gradle</code> racine pour configurer Gradle avec nos modules.</p> <ul><li>Ajoutez un hook sur la tâche <code>compileJava</code> pour ajouter dans l'argument <code>--module-path</code> les valeurs retournées par <code>classpath.asPath</code>.</li> <li>Ajoutez un hook sur la tâche <code>compileTestJava</code> pour configurer <code>javac</code> avec les arguments <code>--module-path</code>, <code>--add-module</code>, <code>--add-reads</code>, <code>--patch-module</code>.</li> <li>Ajoutez un hook sur la tâche <code>test</code> pour configurer <code>javac</code> avec les arguments <code>--module-path</code>, <code>--add-module</code>, <code>--add-reads</code>, <code>--patch-module</code>.</li></ul> <blockquote><p><code>classpath.asPath</code> retourne le classpath tel que calculé en fonction des dépendences définies dans le projet gradle.</p></blockquote> <p>Encore une fois n'hésitez à vous appuyer sur les <a href="/devfest-nantes-jigsaw-docs/TIPS.html">archives de votre droïde</a> en cas de problème(s)!</p> <p><strong>starwars-vertx-http-server/build.gradle</strong></p> <ul><li>Ajoutez un hook sur la tâche <code>run</code> pour ajouter les arguments jvm <code>--modulePath</code> et <code>--module</code>.</li> <li>Ajoutez un hook sur la tâche <code>startScripts</code> avec le contenu suivant.</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token keyword">import</span> java<span class="token operator">.</span>util<span class="token operator">.</span>regex<span class="token operator">.</span>Matcher <span class="token comment">// Matcher is use for replacing args in batchs files</span>
<span class="token punctuation">...</span>

startScripts <span class="token punctuation">{</span>
    inputs<span class="token operator">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string gstring">&quot;moduleName&quot;</span><span class="token punctuation">,</span> moduleName<span class="token punctuation">)</span>
    doFirst <span class="token punctuation">{</span>
        classpath <span class="token operator">=</span> <span class="token function">files</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        defaultJvmOpts <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">'--module-path'</span><span class="token punctuation">,</span> <span class="token string">'APP_HOME_LIBS'</span><span class="token punctuation">,</span> <span class="token comment">// Multi plateform replace in doLast</span>
                <span class="token string">'-Dport=8080'</span><span class="token punctuation">,</span> <span class="token string">'-Ddev=false'</span><span class="token punctuation">,</span>
                <span class="token string">'--module'</span><span class="token punctuation">,</span> mainClassName
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    doLast<span class="token punctuation">{</span>
        <span class="token keyword">def</span> bashFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>outputDir<span class="token punctuation">,</span> applicationName<span class="token punctuation">)</span>
        String bashContent <span class="token operator">=</span> bashFile<span class="token operator">.</span>text
        bashFile<span class="token operator">.</span>text <span class="token operator">=</span> bashContent<span class="token operator">.</span><span class="token function">replaceFirst</span><span class="token punctuation">(</span><span class="token string">'APP_HOME_LIBS'</span><span class="token punctuation">,</span> Matcher<span class="token operator">.</span><span class="token function">quoteReplacement</span><span class="token punctuation">(</span><span class="token string">'$APP_HOME/lib'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">def</span> batFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>outputDir<span class="token punctuation">,</span> applicationName <span class="token operator">+</span> <span class="token string gstring">&quot;.bat&quot;</span><span class="token punctuation">)</span>
        String batContent <span class="token operator">=</span> batFile<span class="token operator">.</span>text
        batFile<span class="token operator">.</span>text <span class="token operator">=</span> batContent<span class="token operator">.</span><span class="token function">replaceFirst</span><span class="token punctuation">(</span><span class="token string">'APP_HOME_LIBS'</span><span class="token punctuation">,</span> Matcher<span class="token operator">.</span><span class="token function">quoteReplacement</span><span class="token punctuation">(</span><span class="token string">'%APP_HOME%\\lib'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Buildez et lancez votre serveur, qui doit fonctionner comme avant!</p> <div class="language-sh extra-class"><pre class="language-text"><code>./gradlew run
</code></pre></div><p>Si vous vous connectez à l'application et regardez la page informations, vous devriez avoir cela :</p> <p><img src="/devfest-nantes-jigsaw-docs/assets/img/module_name_completed.512570ec.png" alt="Module Name Null"> <em>application lancé avec utiliser Jigsaw</em></p> <blockquote><p>Bravo vous avez réussi à utiliser la force sans le côté obscure. Il est maintenant temps pour vous de devenir un maître Jedi! Si la force est avec vous, rendez-vous dans <a href="/devfest-nantes-jigsaw-docs/EPISODE_5.html">l'épisode suivant</a>.</p></blockquote></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/devfest-nantes-jigsaw-docs/EPISODE_3.html" class="prev">
          Episode III - La revanche des Sith Maven
        </a></span> <span class="next"><a href="/devfest-nantes-jigsaw-docs/EPISODE_5.html">
          Episode V - Yoda contre-attaque
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/devfest-nantes-jigsaw-docs/assets/js/7.926724b7.js" defer></script><script src="/devfest-nantes-jigsaw-docs/assets/js/app.d7b56a1b.js" defer></script>
  </body>
</html>
