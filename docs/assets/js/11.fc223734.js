(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{163:function(s,t,e){s.exports=e.p+"assets/img/idea_module_tips.29684df1.png"},166:function(s,t,e){"use strict";e.r(t);var a=[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"tips"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tips","aria-hidden":"true"}},[this._v("#")]),this._v(" TIPS")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"fichier-module-info-java"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fichier-module-info-java","aria-hidden":"true"}},[this._v("#")]),this._v(" Fichier module-info.java")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("    src/org.astro/module-info.java\n    src/org.astro/org/astro/World.java\n    src/com.greetings/com/greetings/Main.java\n    src/com.greetings/module-info.java\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("org.astro\n    src/java/module-info.java\n    src/java/org/astro/World.java\ncom.greetings\n    src/java/com/greetings/Main.java\n    src/java/module-info.java\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Si votre module se nomme "),t("code",[this._v("nom.de.mon.module")]),this._v(", on retrouve ce nom dans la déclaration du module")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[s._v("module nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("de"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mon"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("module "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{attrs:{class:"token comment"}},[s._v("// instructions")]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("TIPS")]),this._v("\nPour éviter les collisions dans les noms de modules, une pratique est de mettre des noms de modules identiques aux noms de package que l'on expose.")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Exposer les éléments publics d'un package : "),t("strong",[this._v("exports")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[this._v("exports nom"),t("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("du"),t("span",{attrs:{class:"token punctuation"}},[this._v(".")]),t("span",{attrs:{class:"token keyword"}},[this._v("package")]),this._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Permettre d'utiliser le module via de la reflexivité : "),t("strong",[this._v("opens")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[this._v("opens nom"),t("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("du"),t("span",{attrs:{class:"token punctuation"}},[this._v(".")]),t("span",{attrs:{class:"token keyword"}},[this._v("package")]),this._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("Attention :")]),this._v(" Cela permet aussi d'\"ouvrir\" à d'autres modules les ressources du package (des fichiers par exemple)")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Permettre à un module d'utiliser un autre module : "),t("strong",[this._v("requires")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[this._v("requires nom"),t("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("du"),t("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("module\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Préciser que l'on fournit l'implementation d'une interface (pour pouvoir l'utiliser avec le ServiceLoader) : "),t("strong",[this._v("provides")]),this._v(" _ "),t("strong",[this._v("with")]),this._v(" _")])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[s._v("provides une"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{attrs:{class:"token keyword"}},[s._v("interface")]),s._v("\n              "),e("span",{attrs:{class:"token class-name"}},[s._v("with")]),s._v(" une"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("implementation\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Pouvoir utiliser (grace au ServiceLoader) les implémentations d'une interface qui ont été définies via "),t("em",[this._v("provides * with *")]),this._v(" : "),t("strong",[this._v("uses")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[this._v("uses une"),t("span",{attrs:{class:"token punctuation"}},[this._v(".")]),t("span",{attrs:{class:"token keyword"}},[this._v("interface")]),this._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("Attention:")]),this._v(" ces instructions n'incluent pas les sous-packages (si vous faites un export sur le package "),t("code",[this._v("a.b")]),this._v(" le package "),t("code",[this._v("a.b.c")]),this._v(" ne sera pas publique pour autant)")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-java extra-class"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[s._v("module nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("de"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mon"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("module "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    exports nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("du"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{attrs:{class:"token keyword"}},[s._v("package")]),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aa"),e("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// rend accessible les objets publiques nom.du.package.aa du package")]),s._v("\n    exports nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("du"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{attrs:{class:"token keyword"}},[s._v("package")]),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bb"),e("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// rend accessible les objets publiques nom.du.package.bb du package")]),s._v("\n\n    opens nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("du"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{attrs:{class:"token keyword"}},[s._v("package")]),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aa"),e("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// ouvre à la reflexivité le package nom.du.package.aa, cela permet aussi d'accéder aux ressources du package")]),s._v("\n\n    requires nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dun"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("autre"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("module"),e("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// permet d'utiliser les objets publiques du module nom.dun.autre.module")]),s._v("\n    requires nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dun"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("second"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("module"),e("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// permet d'utiliser les objets publiques du module nom.dun.second.module")]),s._v("\n\n    provides nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("du"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{attrs:{class:"token keyword"}},[s._v("package")]),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aa"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("InterfaceFoo with nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("du"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{attrs:{class:"token keyword"}},[s._v("package")]),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cc"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FooImpl"),e("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// fournit l'implémentation nom.du.package.cc.FooImpl de l'interface nom.du.package.aa.InterfaceFoo pour le ServiceLoader")]),s._v("\n\n    uses nom"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dun"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("autre"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("module"),e("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("InterfaceBar"),e("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v('// Permettra au ServiceLoader de récupérer les implémentations "provided" de l\'interface nom.dun.autre.module.InterfaceBar présentes au runtime dans le module-path')]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"pour-aller-plus-loin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pour-aller-plus-loin","aria-hidden":"true"}},[this._v("#")]),this._v(" Pour aller plus loin")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ul",[e("li",[e("strong",[s._v("requires transitive")]),s._v(" "),e("em",[s._v("ZZZ")]),s._v(" : permet de spécifier dans le module la dépendances "),e("em",[s._v("ZZZ")]),s._v(" qui sera récupéré par transitivité pour les utilisateurs de ce module")]),s._v(" "),e("li",[e("strong",[s._v("requires static")]),s._v(" "),e("em",[s._v("mysql.jdbc")]),s._v(": permet de gérer les dépendances optionnelles au runtime mais nécessaires à la compilation (ex : une appli qui peut utiliser une base oracle ou mysql ou … on mets un requires static sur les drivers spécifiques)")])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ul",[e("li",[e("strong",[s._v("exports")]),s._v(" "),e("em",[s._v("process")]),s._v(" "),e("strong",[s._v("to")]),s._v(" "),e("em",[s._v("dev.random")]),s._v(" : expose les méthodes publiques du package "),e("em",[s._v("process")]),s._v(" (avec une portée limitée au module "),e("em",[s._v("dev.random")]),s._v(")")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Le module peut être complètement ouvert ("),t("em",[this._v("a great power comes with great responsability")]),this._v(")")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("open")]),this._v(" "),t("em",[this._v("module nom.de.mon.module")]),this._v(" "),t("strong",[this._v("{}")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("java -p api-marvel/build/libs/api-marvel.jar --describe-module org.znk.handson.jigsaw.api\njar --file=api-marvel/build/libs/api-marvel.jar --describe-module\njdeps --module-path ./api-marvel/build/libs/api-marvel.jar -recursive ./marvel-local-impl/build/libs/marvel-local-impl.jar\n...\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Quand vous construisez un module il est nécessaire de lui spécifier le chemin des modules "),t("strong",[this._v("requires")]),this._v(" qui ne sont pas fournis par le JDK (ceux packagés avec votre JDK sont par défaut accessibles).")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("javac ... --module-path PATH ...\n# équivaut à\njavac ... -p PATH ...\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Avec "),t("strong",[this._v("PATH")]),this._v(" qui est la listes des modules (sous formes de JAR, mais peut aussi être des classes et des répertoires; utilise le séparateur du système). Pour retenir : "),t("strong",[this._v("les classes sont dans le classpath, les modules sont dans le modulepath")]),this._v(".")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("dans le cas de jar legacy il est possible de combiner classpath (legacy) et modulepath")]),this._v(" "),t("li",[this._v("dans le cas de multimodules avec des dépendances, on peut utiliser la notion de module-source-path")]),this._v(" "),t("li",[this._v("dans le cas de tests unitaire, les dépendances et les droits d'accès peuvent être ajoutés sans modifier le fichier module-info.java")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# avec junit (4 et 5)\njavac ... --add-modules junit --add-reads nom.de.mon.module=junit ...\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("et le patch d'un module pour lui ajouter les classes de tests (car les packages sont scélés)")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("javac ... --patch-module nom.de.mon.module=src/test/java... ...\n")])])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("p",[s._v("Même idée que pour javac "),e("strong",[s._v("les classes sont dans le classpath, les modules sont dans le modulepath")]),s._v(", pour lancer le "),e("code",[s._v("main")]),s._v(" de la classe "),e("code",[s._v("ma.MainClass")]),s._v(" du module "),e("code",[s._v("nom.de.mon.module")]),s._v(" :")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("java ... --module-path PATH --module nom.de.mon.module/ma.MainClass ...\n# équivaut à\njava ... -p PATH -m nom.de.mon.module/ma.MainClass ...\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Avec "),t("strong",[this._v("PATH")]),this._v(" qui est la liste des modules (sous formes de JAR, mais peut aussi être des classes et des répertoires; utilise le séparateur du système")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# avec junit 4.12 & hamcrest\njava ...  --module-path PATH\n          --add-modules junit \\\n          --add-reads nom.de.mon.module=junit \\\n          --add-reads nom.de.mon.module=hamcrest.core \\\n          --add-exports nom.de.mon.module/nom.du.package=junit \\\n          --add-exports nom.de.mon.module/nom.du.package=hamcrest.core \\\n          --patch-module nom.de.mon.module=src/test/java... \\\n          ...\n")])])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ul",[e("li",[e("strong",[s._v("--add-reads")]),s._v(" : permet au runtime de rendre accessible au module "),e("em",[s._v("nom.de.mon.module")]),s._v(" un module qui n'est pas "),e("em",[s._v("required")]),s._v(" (ici "),e("em",[s._v("junit")]),s._v(")")]),s._v(" "),e("li",[e("strong",[s._v("--add-exports")]),s._v(" : permet au runtime de rendre exportable le package "),e("em",[s._v("nom.du.package")]),s._v(" du module "),e("em",[s._v("nom.de.mon.module")]),s._v(" à un autre module qui n'y aurait normalement pas accès (ici "),e("em",[s._v("junit")]),s._v(")")]),s._v(" "),e("li",[e("strong",[s._v("--add-opens")]),s._v(" : idem que "),e("strong",[s._v("--add-exports")]),s._v(" mais ouverture complète à la reflexivité (inutile dans notre cas puisque la réflexivité est réalisée via de l'indirection depuis le même module)")]),s._v(" "),e("li",[e("strong",[s._v("--patch-module")]),s._v(" : permet de patcher un module en lui ajoutant des classes non présentes initialement (permet d'avoir pour les tests unitaire des noms de package identique à ce qui est testé ce qui n'est pas autorisé par défaut)")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"gradle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle","aria-hidden":"true"}},[this._v("#")]),this._v(" Gradle")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("./gradlew\n\n> Task :help\n\nWelcome to Gradle 4.6.\n\nTo run a build, run gradlew <task> ...\n\nTo see a list of available tasks, run gradlew tasks\n...\n...\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("La liste des principales "),t("code",[this._v("tasks")]),this._v(" utiles au projet")])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ul",[e("li",[e("code",[s._v("check")]),s._v(" (ou "),e("code",[s._v("test")]),s._v(") : lance les tests unitaires (les tests ne sont pas exécutés si le code n'a pas changé)")]),s._v(" "),e("li",[e("code",[s._v("compileJava")]),s._v(" : lance la compilation des classes java (seul le code qui change est compilé)")]),s._v(" "),e("li",[e("code",[s._v("build")]),s._v(" : lance la compilation et les tests unitaires")]),s._v(" "),e("li",[e("code",[s._v("run")]),s._v(' : lance la main classe (pour les applications seulement). Cette commande ne termine "jamais" et reste à un état d\'avancement de 95%')]),s._v(" "),e("li",[e("code",[s._v("jar")]),s._v(" : package le projet, les modules sous forme de jar")]),s._v(" "),e("li",[e("code",[s._v("clean")]),s._v(" : efface le resultat du build, permet par exemple de forcer l'execution des tests s'il n'y a pas eu de modification de code")]),s._v(" "),e("li",[e("code",[s._v("installDist")]),s._v(" : "),e("em",[s._v("optionnel")]),s._v(" génère une distribution du projet avec son script de lancement, ses librairies et ses dépendances")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("code",[this._v("--status")]),this._v(" : affiche le status des daemons gradle")]),this._v(" "),t("li",[t("code",[this._v("--stop")]),this._v(" : arrête les daemons gradle")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Utiliser le plugin chainsaw (il existe un plugin officiel expérimental mais il est moins avancé)")]),this._v(" "),t("li",[this._v("Surcharger les taks spécifiques de compilation, execution et tests")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"utiliser-le-plugin-chainsaw"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#utiliser-le-plugin-chainsaw","aria-hidden":"true"}},[this._v("#")]),this._v(" Utiliser le plugin chainsaw")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[this._v("plugins {\n    id 'java-library'\n"),t("span",{attrs:{class:"token inserted"}},[this._v("+   id 'com.zyxist.chainsaw' version '0.3.1'")]),this._v("\n}\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("Attention")]),this._v(" avec JUnit 5 il faut ouvrir les packages que l'on teste au module "),t("code",[this._v("org.junit.platform.commons")])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[s._v("javaModule"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("hacks "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{attrs:{class:"token function"}},[s._v("exports")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token string"}},[s._v("'<NOM_DU_MODULE>'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string"}},[s._v("'<PACKAGE_A_EXPOSER>'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string"}},[s._v("'org.junit.platform.commons'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"utiliser-la-configuration-gradle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#utiliser-la-configuration-gradle","aria-hidden":"true"}},[this._v("#")]),this._v(" Utiliser la configuration gradle")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"definir-dans-la-variable-le-nom-du-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#definir-dans-la-variable-le-nom-du-module","aria-hidden":"true"}},[this._v("#")]),this._v(" Définir dans la variable le nom du module")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("La variable "),t("code",[this._v("moduleName")]),this._v(" sera utilisée par la suite (notamment dans les tests)")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[this._v("plugins {\n    id 'java-library'\n}\n\n"),t("span",{attrs:{class:"token inserted"}},[this._v('+ ext.moduleName = "org.zenika.handson.jigsaw.api"')]),this._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"surcharger-les-options-de-compilation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#surcharger-les-options-de-compilation","aria-hidden":"true"}},[this._v("#")]),this._v(" Surcharger les options de compilation")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Dans votre build.gradle afin d'avoir un "),t("code",[this._v("modulepath")]),this._v(" alimenté à partir de ce qui irait normalement dans le "),t("code",[this._v("classpath")])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[s._v("    compileJava "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        doFirst "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            options"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("compilerArgs "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                    "),e("span",{attrs:{class:"token string"}},[s._v("'--module-path'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" classpath"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("asPath"),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// alimente le modulepath via le classpath")]),s._v("\n            "),e("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            classpath "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token function"}},[s._v("files")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// vide le classpath")]),s._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"surcharger-les-options-de-compilation-des-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#surcharger-les-options-de-compilation-des-tests","aria-hidden":"true"}},[this._v("#")]),this._v(" Surcharger les options de compilation des tests")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Modifier le graph de dépendance pour y ajouter le module junit")]),this._v(" "),t("li",[this._v("Modifier le graph de dépendance pour que le module puisse utiliser junit (équivaut à un "),t("code",[this._v("requires")]),this._v(")")]),this._v(" "),t("li",[this._v("Patcher le module pour forcer l'inclusion des classes de tests dans le package (les packages sont scellés, les tests étant dans un autre répertoire mais dans le même package, les mécanismes de protection de Jigsaw s'activent)")])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[s._v("    compileTestJava "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        inputs"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),e("span",{attrs:{class:"token function"}},[s._v("property")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token string gstring"}},[s._v('"moduleName"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" moduleName"),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// la variable moduleName doit être déclarée dans chaque build.gradle des modules")]),s._v("\n        doFirst "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            options"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("compilerArgs "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                    "),e("span",{attrs:{class:"token string"}},[s._v("'--module-path'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" classpath"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("asPath"),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    "),e("span",{attrs:{class:"token string"}},[s._v("'--add-modules'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string"}},[s._v("'org.junit.jupiter.api'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// junit fait maintenant partie du graphe des modules alors qu'il n'a pas de dépendance transitive")]),s._v("\n                    "),e("span",{attrs:{class:"token string"}},[s._v("'--add-reads'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=org.junit.jupiter.api"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// equivaut à faire dans le module un requires org.junit.jupiter.api")]),s._v("\n                    "),e("span",{attrs:{class:"token string"}},[s._v("'--add-reads'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=org.junit.platform.commons"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// idem ...")]),s._v("\n                    "),e("span",{attrs:{class:"token string"}},[s._v("'--patch-module'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('="')]),s._v(" "),e("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{attrs:{class:"token function"}},[s._v("files")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sourceSets"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("test"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("java"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("srcDirs"),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("asPath"),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v("// patch le module")]),s._v("\n            "),e("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            classpath "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token function"}},[s._v("files")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"surcharger-les-options-d-execution"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#surcharger-les-options-d-execution","aria-hidden":"true"}},[this._v("#")]),this._v(" Surcharger les options d'exécution")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Spécifier la main classe qui sera lancée (via un --module)")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("Cette configuration s'applique au plugin "),t("code",[this._v("application")])])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[s._v("plugins "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    id "),e("span",{attrs:{class:"token string"}},[s._v("'application'")]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\nmainClassName "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('/org.zenika.handson.jigsaw.http.Application"')]),s._v("\n\nrun "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    inputs"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),e("span",{attrs:{class:"token function"}},[s._v("property")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token string gstring"}},[s._v('"moduleName"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" moduleName"),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    doFirst "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        jvmArgs "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--module-path'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" classpath"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("asPath"),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--module'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mainClassName"),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token comment"}},[s._v('// utiliser l\'option module pour lancer la "main class"')]),s._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        classpath "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token function"}},[s._v("files")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        copy "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),e("span",{attrs:{class:"token comment"}},[s._v("// Les ressources étant encore dans un répertoire différent, elles ne sont pas accessibles avec l'isolation de Jigsaw => il faut donc les copier dans le répertoire contenant les classes")]),s._v("\n            from "),e("span",{attrs:{class:"token string"}},[s._v("'src/main/resources'")]),s._v("\n            into "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("buildDir")]),s._v('/classes/java/main/"')]),s._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"surcharger-les-options-d-execution-des-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#surcharger-les-options-d-execution-des-tests","aria-hidden":"true"}},[this._v("#")]),this._v(" Surcharger les options d'exécution des tests")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("code",[this._v("add-export")]),this._v(" pour exposer à junit les packages qui seront testés")]),this._v(" "),t("li",[t("code",[this._v("add-modules ALL-MODULE-PATH")]),this._v(" pour ajouter dans le graphe de résolution tous les modules (et auto modules) qui sont dans le module-path")])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[s._v("test "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    inputs"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),e("span",{attrs:{class:"token function"}},[s._v("property")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token string gstring"}},[s._v('"moduleName"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" moduleName"),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n    doFirst "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{attrs:{class:"token comment"}},[s._v("// Hack Les ressources étant encore dans un répertoire différent elles ne sont pas accessibles avec l'isolation de Jigsaw => il faut donc les copier dans le répertoire contenant les classes")]),s._v("\n        copy "),e("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            from "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("projectDir")]),s._v('/src/main/resources"')]),s._v("\n            into "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("buildDir")]),s._v('/classes/java/main/"')]),s._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        jvmArgs "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),e("span",{attrs:{class:"token comment"}},[s._v("//'--show-module-resolution', // le pouvoir de vision peut vous sauver la vie")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--module-path'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" classpath"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("asPath"),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--add-modules'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string"}},[s._v("'ALL-MODULE-PATH'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--add-reads'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=org.junit.jupiter.api"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--add-reads'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=org.junit.platform.commons"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--add-reads'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=feign.core"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--add-reads'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=feign.gson"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--add-exports'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v("/"),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=org.junit.jupiter.api"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--add-exports'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v("/"),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('=org.junit.platform.commons"')]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{attrs:{class:"token string"}},[s._v("'--patch-module'")]),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{attrs:{class:"token string gstring"}},[s._v('"'),e("span",{attrs:{class:"token expression"}},[e("span",{attrs:{class:"token punctuation"}},[s._v("$")]),s._v("moduleName")]),s._v('="')]),s._v(" "),e("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{attrs:{class:"token function"}},[s._v("files")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sourceSets"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("test"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("java"),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("outputDir"),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{attrs:{class:"token operator"}},[s._v(".")]),s._v("asPath"),e("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        classpath "),e("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{attrs:{class:"token function"}},[s._v("files")]),e("span",{attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"idea-et-les-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#idea-et-les-modules","aria-hidden":"true"}},[this._v("#")]),this._v(" IDEA et les modules")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("Dans un livrable packagé (ex: un jar), les ressources sont dans la même arborescence que les classes, les classes peuvent donc accéder aux ressources sans faire face aux restrictions d'accès des modules")]),this._v(" "),t("li",[this._v("En phase de développement les ressources et les classes compilées sont dans des arborescences différentes, à l'exécution ces arborescences sont passées en arguments de "),t("code",[this._v("java")]),this._v(". Les classes étant positionnées ailleurs elles n'ont pas accès aux ressources.")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("java ... .../marvel-http-server/out/production/classes:.../marvel-http-server/out/production/resources:.../devoxx-exo/marvel-local-impl/out/production/classes:.../marvel-local-impl/out/production/resources:... -m org.zenika.handson.jigsaw.http/org.zenika.handson.jigsaw.http.Application\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Dans notre application les ressources sont incluses dans le code et donc accédées via le classloader ce qui ne marche pas dans le cas présent. Il est cependant possible de contourner cela, en choisissant pour les modules qui ont ce besoin ("),t("code",[this._v("org.zenika.handson.jigsaw.api.local.impl")]),this._v(" et "),t("code",[this._v("org.zenika.handson.jigsaw.http")]),this._v("), d'utiliser dans IDJ une arborescente en developpement spécifique au runtime (File/Project Structure/Project Settings/Module..."),t("strong",[this._v("Use module compile output path")]),this._v(" voir copie d'écran)")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:e(163),alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"generation-de-modules-linkes-et-jre-optimise"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#generation-de-modules-linkes-et-jre-optimise","aria-hidden":"true"}},[this._v("#")]),this._v(' Génération de modules "linkés" et JRE optimisé')])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("Attention")]),this._v(" cette fonctionnalité est limitée aux modules (on ne peut pas inclure de jar legacy ou d'auto-modules pour générer un JRE optimisé)")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# generation des jar\n./gradlew jar\n\n# generation de la JVM packagée avec nos modules et ses dépendances\njlink \\\n--module-path $JAVA_HOME/jmods:`pwd`/api-marvel/build/libs/api-marvel.jar:...liste_des_binaires_modules_ou_repertoire....   \\\n--add-modules org.zenika.handson.jigsaw.api.local.impl,...liste_des_noms_des_modules...\\\n--output `pwd`/marveljre --launcher marvelous=org.zenika.handson.jigsaw.http/org.zenika.handson.jigsaw.http.Application \\\n--compress=2\n\n# affichage des modules de notre JRE optimisé\n./marveljre/bin/java --list-modules\n")])])])},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ul",[e("li",[s._v("java.base@9.0.4")]),s._v(" "),e("li",[s._v("java.logging@9.0.4")]),s._v(" "),e("li",[s._v("jdk.httpserver@9.0.4")]),s._v(" "),e("li",[s._v("me.xdrop.diffutils")]),s._v(" "),e("li",[s._v("me.xdrop.fuzzywuzzy")]),s._v(" "),e("li",[s._v("org.zenika.handson.jigsaw.api")]),s._v(" "),e("li",[s._v("org.zenika.handson.jigsaw.api.local.impl")]),s._v(" "),e("li",[s._v("org.zenika.handson.jigsaw.http open")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("La version @9.0.4 est celle de la JVM \"source\". Si l'on voulait avoir un numéro de version il faut générer le jar avec l'option "),t("em",[this._v("--module-version")]),this._v(" (mais cette information n'est malheureusement pas exploitée pour gérer les versions des modules)")])}],n=e(0),r=Object(n.a)({},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"content"},[s._m(0),s._v(" "),e("p",[s._v("Une question, un doute sur votre pouvoir de modularisation? Vous trouverez tout ce qu'il vous faut ici!")]),s._v(" "),s._m(1),s._v(" "),e("p",[s._v("Ce fichier permet de décrire un module, il doit être présent à la racine des sources du module (ici dans src/main/java).\nEn \"standard\" l'arborescence des projets avec plusieurs modules diffère de celle que l'on retrouve classiquement :")]),s._v(" "),e("p",[e("a",{attrs:{href:"http://openjdk.java.net/projects/jigsaw/quick-start",target:"_blank",rel:"noopener noreferrer"}},[s._v("Exemple d'Oracle"),e("OutboundLink")],1),s._v(" pour les modules "),e("code",[s._v("org.astro")]),s._v(" et "),e("code",[s._v("com.greetings")])]),s._v(" "),s._m(2),e("p",[s._v("Mais il reste possible d'avoir une arborescence plus classique (ce qui sera fait ici) :")]),s._v(" "),s._m(3),s._m(4),s._v(" "),s._m(5),s._m(6),s._v(" "),e("p",[s._v("Un module peut contenir des instructions pour :")]),s._v(" "),s._m(7),s._v(" "),s._m(8),s._m(9),s._v(" "),s._m(10),s._m(11),s._v(" "),s._m(12),s._v(" "),s._m(13),s._m(14),s._v(" "),s._m(15),s._m(16),s._v(" "),s._m(17),s._m(18),s._v(" "),e("p",[s._v("En résumé :")]),s._v(" "),s._m(19),s._m(20),s._v(" "),e("p",[s._v("La gestion des dépendances peut être affinée :")]),s._v(" "),s._m(21),s._v(" "),e("p",[s._v("La portée de ce qui est exposé peut être limitée à des modules spécifiques :")]),s._v(" "),s._m(22),s._v(" "),s._m(23),s._v(" "),s._m(24),s._v(" "),e("p",[s._v("Le JDK étant lui même modulaire, pour connaitre la liste des modules et leurs dépendances :")]),s._v(" "),e("ul",[e("li",[s._v("La "),e("a",{attrs:{href:"https://docs.oracle.com/javase/9/docs/api/overview-summary.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("javadoc"),e("OutboundLink")],1),s._v(" (en htm5, avec un search, la révolution...)")]),s._v(" "),e("li",[s._v("Le "),e("a",{attrs:{href:"http://cr.openjdk.java.net/~mr/jigsaw/jdk9-module-summary.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JDK Module Summary"),e("OutboundLink")],1)]),s._v(" "),e("li",[s._v("De nouvelles options et programmes dans la CLI du JDK")])]),s._v(" "),s._m(25),e("h2",{attrs:{id:"javac-et-les-modules"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#javac-et-les-modules","aria-hidden":"true"}},[s._v("#")]),s._v(" "),e("a",{attrs:{href:"https://docs.oracle.com/javase/9/tools/javac.htm#JSWOR627",target:"_blank",rel:"noopener noreferrer"}},[s._v("javac"),e("OutboundLink")],1),s._v(" et les modules")]),s._v(" "),s._m(26),s._v(" "),s._m(27),s._m(28),s._v(" "),e("p",[s._v("Astuces :")]),s._v(" "),s._m(29),s._v(" "),s._m(30),s._m(31),s._v(" "),s._m(32),e("h2",{attrs:{id:"java-et-les-modules"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#java-et-les-modules","aria-hidden":"true"}},[s._v("#")]),s._v(" "),e("a",{attrs:{href:"https://docs.oracle.com/javase/9/tools/java.htm#JSWOR624",target:"_blank",rel:"noopener noreferrer"}},[s._v("java"),e("OutboundLink")],1),s._v(" et les modules")]),s._v(" "),s._m(33),s._v(" "),s._m(34),s._m(35),s._v(" "),e("p",[s._v("Pour les tests unitaires il faut, là aussi, modifier les droits et dépendances pour que nos librairies de tests puissent accéder à notre module et que notre classe de tests puisse les utiliser.")]),s._v(" "),s._m(36),s._m(37),s._v(" "),s._m(38),s._v(" "),e("p",[s._v("Un wrapper de Gradle est directement disponible dans le projet en version 4.6. Pour le lancer depuis la racine du projet")]),s._v(" "),s._m(39),e("p",[s._v("Le premier lancement va être un peu plus long car il va télécharger la distribution de gradle.")]),s._v(" "),s._m(40),s._v(" "),s._m(41),s._v(" "),e("p",[s._v("Autre commandes utiles à gradle ;")]),s._v(" "),s._m(42),s._v(" "),e("p",[s._v("Gradle fonctionne en mode classpath, cependant il est possible (et c'est ce pourquoi vous êtes ici) de changer cela.\n2 approches sont possibles :")]),s._v(" "),s._m(43),s._v(" "),s._m(44),s._v(" "),e("p",[s._v("Il suffit d'ajouter dans les plugins du(/des) projet(s), le plugin com.zyxist.chainsaw")]),s._v(" "),s._m(45),s._m(46),s._v(" "),s._m(47),s._m(48),s._v(" "),s._m(49),s._v(" "),s._m(50),s._v(" "),s._m(51),s._m(52),s._v(" "),s._m(53),s._v(" "),s._m(54),s._m(55),s._v(" "),e("p",[s._v("Pour les tests en plus du modulepath il faut :")]),s._v(" "),s._m(56),s._v(" "),s._m(57),s._m(58),s._v(" "),e("p",[s._v("Il faut en plus :")]),s._v(" "),s._m(59),s._v(" "),s._m(60),s._v(" "),s._m(61),s._m(62),s._v(" "),e("p",[s._v("Il faut en plus :")]),s._v(" "),s._m(63),s._v(" "),s._m(64),s._m(65),s._v(" "),e("p",[s._v("La prise en charge des modules ne se limite pas à gérer la phase de compilation. Il faut aussi le prendre en compte en phase d'exécution.")]),s._v(" "),e("p",[s._v("IDEA gère cela pour les applications, pour les tests l'IDE utilise encore le classpath (ce qui évite d'avoir à gérer les patchs, add-export et autres joies des tests unitaires avec les modules).")]),s._v(" "),e("p",[s._v("IDJ ne prend pas en compte tous les cas complexes que l'on peut rencontrer avec les ressources et les modules :")]),s._v(" "),s._m(66),s._v(" "),s._m(67),s._m(68),s._v(" "),s._m(69),s._v(" "),s._m(70),s._v(" "),e("p",[s._v("Ces fonctions avancées permettent d’avoir une application packagée avec une JVM allégée ainsi qu’un graphe des dépendances déjà calculé et contrôlé pour optimiser le temps de démarrage.")]),s._v(" "),s._m(71),s._v(" "),s._m(72),e("p",[s._v('La liste des modules de notre JRE "light" est')]),s._v(" "),s._m(73),s._v(" "),s._m(74)])},a,!1,null,null,null);r.options.__file="TIPS.md";t.default=r.exports}}]);